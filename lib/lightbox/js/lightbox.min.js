/*!
 * Lightbox v2.11.4
 * by Lokesh Dhakar
 * 
 * This script enables a modal image gallery with "lightbox" effects for showing images.
 * Users can navigate between images, view captions, and more.
 * 
 * Copyright Lokesh Dhakar
 * Released under the MIT license
 * 
 * @preserve
 */
!function(global, factory) {
    // UMD (Universal Module Definition) to support AMD, CommonJS, and browser environments
    if (typeof define === "function" && define.amd) {
      define(["jquery"], factory); // If AMD is available, use it
    } else if (typeof exports === "object") {
      module.exports = factory(require("jquery")); // For CommonJS
    } else {
      global.lightbox = factory(global.jQuery); // For browser environment
    }
  }(this, function($) {
    // Lightbox function definition
    function Lightbox(options) {
      this.album = [];  // Array to store all images for the current gallery
      this.currentImageIndex = undefined;  // Index of the currently viewed image
      this.init();  // Initialize the lightbox
      this.options = $.extend({}, this.constructor.defaults);  // Default options
      this.option(options);  // Extend options with the provided configuration
    }
  
    // Default settings for the lightbox
    Lightbox.defaults = {
      albumLabel: "Image %1 of %2",  // Text format for the image number
      alwaysShowNavOnTouchDevices: false,  // Whether to always show navigation on touch devices
      fadeDuration: 600,  // Duration for fading transitions
      fitImagesInViewport: true,  // Whether to fit images in the viewport
      imageFadeDuration: 600,  // Duration for image fade-in
      positionFromTop: 50,  // Position of the lightbox from the top of the window
      resizeDuration: 700,  // Duration for resizing the container
      showImageNumberLabel: true,  // Whether to show image number label
      wrapAround: false,  // Whether to allow wrapping around between images
      disableScrolling: false,  // Whether to disable page scrolling while lightbox is active
      sanitizeTitle: false,  // Whether to sanitize the image title
    };
  
    // Method to extend the options with user-provided values
    Lightbox.prototype.option = function(options) {
      $.extend(this.options, options);
    };
  
    // Method to generate the image count label, e.g., "Image 1 of 5"
    Lightbox.prototype.imageCountLabel = function(current, total) {
      return this.options.albumLabel.replace(/%1/g, current).replace(/%2/g, total);
    };
  
    // Initialize the lightbox functionality
    Lightbox.prototype.init = function() {
      var _this = this;
      $(document).ready(function() {
        _this.enable();  // Enable the lightbox functionality
        _this.build();   // Build the lightbox HTML structure
      });
    };
  
    // Enable the lightbox by binding the click event to image links
    Lightbox.prototype.enable = function() {
      var _this = this;
      $("body").on("click", "a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]", function(event) {
        return _this.start($(event.currentTarget)), false;  // Start the lightbox when a link is clicked
      });
    };
  
    // Build the lightbox HTML structure if it doesn't exist yet
    Lightbox.prototype.build = function() {
      if ($("#lightbox").length > 0) return; // If lightbox already exists, do nothing
  
      var _this = this;
  
      // Create the HTML structure for the lightbox
      $('<div id="lightboxOverlay" tabindex="-1" class="lightboxOverlay"></div><div id="lightbox" tabindex="-1" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=""/><div class="lb-nav"><a class="lb-prev" role="button" tabindex="0" aria-label="Previous image" href="" ></a><a class="lb-next" role="button" tabindex="0" aria-label="Next image" href="" ></a></div><div class="lb-loader"><a class="lb-cancel" role="button" tabindex="0"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close" role="button" tabindex="0"></a></div></div></div></div>').appendTo($("body"));
  
      // Cache the lightbox elements for later use
      this.$lightbox = $("#lightbox");
      this.$overlay = $("#lightboxOverlay");
      this.$outerContainer = this.$lightbox.find(".lb-outerContainer");
      this.$container = this.$lightbox.find(".lb-container");
      this.$image = this.$lightbox.find(".lb-image");
      this.$nav = this.$lightbox.find(".lb-nav");
  
      // Container padding and image border width for layout calculations
      this.containerPadding = {
        top: parseInt(this.$container.css("padding-top"), 10),
        right: parseInt(this.$container.css("padding-right"), 10),
        bottom: parseInt(this.$container.css("padding-bottom"), 10),
        left: parseInt(this.$container.css("padding-left"), 10),
      };
      this.imageBorderWidth = {
        top: parseInt(this.$image.css("border-top-width"), 10),
        right: parseInt(this.$image.css("border-right-width"), 10),
        bottom: parseInt(this.$image.css("border-bottom-width"), 10),
        left: parseInt(this.$image.css("border-left-width"), 10),
      };
  
      // Set up event listeners
      this.$overlay.hide().on("click", function() { return _this.end(), false; });  // Hide the lightbox when overlay is clicked
      this.$lightbox.hide().on("click", function(event) {
        if ($(event.target).attr("id") === "lightbox") {
          return _this.end(), false;
        }
      });
      this.$outerContainer.on("click", function(event) {
        if ($(event.target).attr("id") === "lightbox") {
          return _this.end(), false;
        }
      });
      this.$lightbox.find(".lb-prev").on("click", function() {
        return _this.currentImageIndex === 0 ? _this.changeImage(_this.album.length - 1) : _this.changeImage(_this.currentImageIndex - 1), false;
      });
      this.$lightbox.find(".lb-next").on("click", function() {
        return _this.currentImageIndex === _this.album.length - 1 ? _this.changeImage(0) : _this.changeImage(_this.currentImageIndex + 1), false;
      });
      this.$lightbox.find(".lb-loader, .lb-close").on("click keyup", function(event) {
        if (event.type === "click" || (event.type === "keyup" && (event.which === 13 || event.which === 32))) {
          return _this.end(), false;
        }
      });
    };
  
    // Start the lightbox by gathering information about the clicked image
    Lightbox.prototype.start = function($link) {
      var _this = this;
      var windowWidth = $(window).width();
      var windowHeight = $(window).height();
  
      // Set up the album array and find the index of the clicked image
      this.album = [];
      var index = 0;
      var group = $link.attr("data-lightbox");
  
      // Get all images in the group
      var $groupLinks = $("a[data-lightbox='" + group + "']");
      $groupLinks.each(function(i, el) {
        _this.album.push({
          alt: $(el).attr("data-alt"),
          link: $(el).attr("href"),
          title: $(el).attr("data-title") || $(el).attr("title"),
        });
        if ($(el)[0] === $link[0]) index = i; // Find the index of the clicked image
      });
  
      // Set the position of the lightbox relative to the page
      var topOffset = $(window).scrollTop() + this.options.positionFromTop;
      var leftOffset = $(window).scrollLeft();
      this.$lightbox.css({
        top: topOffset + "px",
        left: leftOffset + "px",
      }).fadeIn(this.options.fadeDuration);
  
      // Disable scrolling on the page
      if (this.options.disableScrolling) $("body").addClass("lb-disable-scrolling");
  
      // Change the image based on the clicked index
      this.changeImage(index);
    };
  
    // Change the current image to the one at the specified index
    Lightbox.prototype.changeImage = function(index) {
      var _this = this;
      var imageSrc = this.album[index].link;
      var imageType = imageSrc.split(".").pop(); // Get the file extension (e.g., "jpg")
  
      this.disableKeyboardNav();  // Disable keyboard navigation while changing the image
  
      // Show the overlay and loader
      this.$overlay.fadeIn(this.options.fadeDuration);
      $(".lb-loader").fadeIn("slow");
  
      // Hide the lightbox elements initially
      this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide();
      this.$outerContainer.addClass("animating");
  
      // Preload the image and set it when loaded
      var img = new Image();
      img.onload = function() {
        var imgElement = _this.$lightbox.find(".lb-image");
        imgElement.attr("alt", _this.album[index].alt).attr("src", imageSrc);
        imgElement.width(img.width);
        imgElement.height(img.height);
  
        // Adjust the image size to fit within the viewport
        var maxWidth = windowWidth - _this.containerPadding.left - _this.containerPadding.right - _this.imageBorderWidth.left - _this.imageBorderWidth.right - 20;
        var maxHeight = windowHeight - _this.containerPadding.top - _this.containerPadding.bottom - _this.imageBorderWidth.top - _this.imageBorderWidth.bottom - _this.options.positionFromTop - 70;
  
        // Resize the image if necessary
        var widthRatio = img.width / maxWidth;
        var heightRatio = img.height / maxHeight;
        if (widthRatio > heightRatio) {
          imgElement.width(maxWidth);
          imgElement.height(img.height / widthRatio);
        } else {
          imgElement.height(maxHeight);
          imgElement.width(img.width / heightRatio);
        }
  
        _this.sizeContainer(imgElement.width(), imgElement.height());  // Adjust the container size
      };
      img.src = imageSrc;  // Start loading the image
  
      this.currentImageIndex = index;  // Update the current image index
    };
  
    // Resize the overlay to fit the full page
    Lightbox.prototype.sizeOverlay = function() {
      var _this = this;
      setTimeout(function() {
        _this.$overlay.width($(document).width()).height($(document).height());
      }, 0);
    };
  
    // Resize the container to match the image size
    Lightbox.prototype.sizeContainer = function(width, height) {
      var _this = this;
      var containerWidth = width + this.containerPadding.left + this.containerPadding.right + this.imageBorderWidth.left + this.imageBorderWidth.right;
      var containerHeight = height + this.containerPadding.top + this.containerPadding.bottom + this.imageBorderWidth.top + this.imageBorderWidth.bottom;
  
      var animationCallback = function() {
        _this.$lightbox.find(".lb-dataContainer").width(containerWidth);
        _this.$lightbox.find(".lb-prevLink").height(height);
        _this.$lightbox.find(".lb-nextLink").height(height);
        _this.sizeOverlay();
        _this.showImage();
      };
  
      // Animate the container resize
      var currentWidth = this.$outerContainer.outerWidth();
      var currentHeight = this.$outerContainer.outerHeight();
      if (currentWidth !== containerWidth || currentHeight !== containerHeight) {
        this.$outerContainer.animate({ width: containerWidth, height: containerHeight }, this.options.resizeDuration, "swing", function() {
          animationCallback();
        });
      } else {
        animationCallback();
      }
    };
  
    // Show the image after the container has resized
    Lightbox.prototype.showImage = function() {
      this.$lightbox.find(".lb-loader").stop(true).hide();
      this.$lightbox.find(".lb-image").fadeIn(this.options.imageFadeDuration);
      this.updateNav();
      this.updateDetails();
      this.preloadNeighboringImages();
      this.enableKeyboardNav();
    };
  
    // Update navigation buttons (prev/next) visibility
    Lightbox.prototype.updateNav = function() {
      var _this = this;
      var alwaysShowNav = false;
      
      try {
        document.createEvent("TouchEvent");
        alwaysShowNav = !!this.options.alwaysShowNavOnTouchDevices;
      } catch (e) {
        // Ignore errors for non-touch devices
      }
  
      this.$lightbox.find(".lb-nav").show();
  
      if (this.album.length > 1) {
        if (this.options.wrapAround) {
          if (alwaysShowNav) {
            this.$lightbox.find(".lb-prev, .lb-next").css("opacity", "1");
          }
          this.$lightbox.find(".lb-prev, .lb-next").show();
        } else {
          // Show only previous/next if there are more images
          if (this.currentImageIndex > 0) {
            this.$lightbox.find(".lb-prev").show();
            if (alwaysShowNav) {
              this.$lightbox.find(".lb-prev").css("opacity", "1");
            }
          }
          if (this.currentImageIndex < this.album.length - 1) {
            this.$lightbox.find(".lb-next").show();
            if (alwaysShowNav) {
              this.$lightbox.find(".lb-next").css("opacity", "1");
            }
          }
        }
      }
    };
  
    // Update the caption and image number details
    Lightbox.prototype.updateDetails = function() {
      var _this = this;
      var currentImage = this.album[this.currentImageIndex];
      
      // Update caption
      if (currentImage.title) {
        var captionElement = this.$lightbox.find(".lb-caption");
        if (this.options.sanitizeTitle) {
          captionElement.text(currentImage.title);
        } else {
          captionElement.html(currentImage.title);
        }
        captionElement.fadeIn("fast");
      }
  
      // Show image number label
      if (this.album.length > 1 && this.options.showImageNumberLabel) {
        var imageNumberLabel = this.imageCountLabel(this.currentImageIndex + 1, this.album.length);
        this.$lightbox.find(".lb-number").text(imageNumberLabel).fadeIn("fast");
      } else {
        this.$lightbox.find(".lb-number").hide();
      }
  
      this.$outerContainer.removeClass("animating");
      this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration, function() {
        _this.sizeOverlay();
      });
    };
  
    // Preload neighboring images to improve navigation experience
    Lightbox.prototype.preloadNeighboringImages = function() {
      if (this.album.length > this.currentImageIndex + 1) {
        (new Image()).src = this.album[this.currentImageIndex + 1].link;
      }
      if (this.currentImageIndex > 0) {
        (new Image()).src = this.album[this.currentImageIndex - 1].link;
      }
    };
  
    // Enable keyboard navigation for closing or navigating images
    Lightbox.prototype.enableKeyboardNav = function() {
      this.$lightbox.on("keyup.keyboard", $.proxy(this.keyboardAction, this));
      this.$overlay.on("keyup.keyboard", $.proxy(this.keyboardAction, this));
    };
  
    // Disable keyboard navigation
    Lightbox.prototype.disableKeyboardNav = function() {
      this.$lightbox.off(".keyboard");
      this.$overlay.off(".keyboard");
    };
  
    // Handle keyboard actions: Escape to close, Left/Right arrow to navigate
    Lightbox.prototype.keyboardAction = function(event) {
      var keyCode = event.keyCode;
      if (keyCode === 27) { // Escape key
        event.stopPropagation();
        this.end(); // Close the lightbox
      } else if (keyCode === 37) { // Left arrow
        if (this.currentImageIndex !== 0) {
          this.changeImage(this.currentImageIndex - 1);
        } else if (this.options.wrapAround && this.album.length > 1) {
          this.changeImage(this.album.length - 1);
        }
      } else if (keyCode === 39) { // Right arrow
        if (this.currentImageIndex !== this.album.length - 1) {
          this.changeImage(this.currentImageIndex + 1);
        } else if (this.options.wrapAround && this.album.length > 1) {
          this.changeImage(0);
        }
      }
    };
  
    // Close the lightbox and remove event listeners
    Lightbox.prototype.end = function() {
      this.disableKeyboardNav();
      $(window).off("resize", this.sizeOverlay);  // Remove resize listener
      this.$lightbox.fadeOut(this.options.fadeDuration);  // Hide the lightbox
      this.$overlay.fadeOut(this.options.fadeDuration);  // Hide the overlay
  
      // Re-enable scrolling if it was disabled
      if (this.options.disableScrolling) {
        $("body").removeClass("lb-disable-scrolling");
      }
    };
  
    // Return a new Lightbox instance
    return new Lightbox();
  });
  